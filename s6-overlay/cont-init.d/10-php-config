#!/usr/bin/with-contenv bash

echo "Configuring PHP settings from environment variables..."

# Create/update PHP configuration files based on environment variables
echo "memory_limit = ${PHP_MEMORY_LIMIT}" > /usr/local/etc/php/conf.d/memory-limit.ini
echo "upload_max_filesize = ${PHP_UPLOAD_MAX_FILESIZE}" > /usr/local/etc/php/conf.d/upload-limit.ini
echo "post_max_size = ${PHP_POST_MAX_SIZE}" > /usr/local/etc/php/conf.d/post-limit.ini
echo "max_execution_time = ${PHP_MAX_EXECUTION_TIME}" > /usr/local/etc/php/conf.d/max-execution-time.ini
echo "max_input_vars = ${PHP_MAX_INPUT_VARS}" > /usr/local/etc/php/conf.d/max-input-vars.ini

# Error reporting settings
echo "error_reporting = ${PHP_ERROR_REPORTING}" > /usr/local/etc/php/conf.d/error-reporting.ini
echo "display_errors = ${PHP_DISPLAY_ERRORS}" >> /usr/local/etc/php/conf.d/error-reporting.ini
echo "log_errors = ${PHP_LOG_ERRORS}" >> /usr/local/etc/php/conf.d/error-reporting.ini

# OPCache settings
echo "opcache.memory_consumption = ${PHP_OPCACHE_MEMORY_CONSUMPTION}" > /usr/local/etc/php/conf.d/opcache-config.ini
echo "opcache.interned_strings_buffer = ${PHP_OPCACHE_INTERNED_STRINGS_BUFFER}" >> /usr/local/etc/php/conf.d/opcache-config.ini
echo "opcache.max_accelerated_files = ${PHP_OPCACHE_MAX_ACCELERATED_FILES}" >> /usr/local/etc/php/conf.d/opcache-config.ini
echo "opcache.revalidate_freq = ${PHP_OPCACHE_REVALIDATE_FREQ}" >> /usr/local/etc/php/conf.d/opcache-config.ini

# Session settings
echo "session.gc_maxlifetime = ${PHP_SESSION_GC_MAXLIFETIME}" > /usr/local/etc/php/conf.d/session.ini

# Additional settings
echo "max_file_uploads = ${PHP_MAX_FILE_UPLOADS}" >> /usr/local/etc/php/conf.d/upload-limit.ini
echo "date.timezone = ${PHP_DATE_TIMEZONE}" > /usr/local/etc/php/conf.d/timezone.ini

echo "PHP configuration updated successfully"
